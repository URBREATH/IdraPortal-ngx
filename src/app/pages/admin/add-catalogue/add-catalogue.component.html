 
<nb-card class="minicard">
    <nb-card-body class="d-flex flex-column align-items-left justify-content-left" (messageEvent)="receiveMode($event)">
        <label>{{ receivedMode }}</label>
        <h4 class="jumbotron-heading" *ngIf="!modifyId">{{ 'ADD_CATALOGUE' | translate }}</h4>
        <h4 class="jumbotron-heading" *ngIf="modifyId">{{ 'MODIFY_CATALOGUE' | translate }}</h4>
    </nb-card-body>
</nb-card>

<div class="row show-grid" [nbSpinner]="loading" nbSpinnerStatus="primary">
    <div class="col-md-5">
        <nb-card class="minicard">
            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'IMAGE' | translate }}</h6>
                <div class="custom-file">
                    <input nbInput type="file" class="form-control background-white" id="importFile" (change)="onFileChange($event.target.files[0],0)">
                </div>
                <div class="height-fit-content">
                    <img id="image" [src]="imageUrl" alt="" class="image-component">
                </div>
            </nb-card-body>
        </nb-card>
    </div>

    <div class="col-md-7">
        <nb-card class="minicard">
            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'NAME' | translate }}</h6>
                <input type="text" nbInput fullWidth status="primary" required [(ngModel)]="node.name" placeholder="{{ 'NAME' | translate }}">
            </nb-card-body>

            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'PUBLISHER' | translate }}</h6>
                <input type="text" nbInput fullWidth status="primary" [(ngModel)]="node.publisherName" placeholder="{{ 'PUBLISHER' | translate }}">
            </nb-card-body>

            <div class="row show-grid">
                <div class="col-md-6">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'COUNTRY' | translate }}</h6>
                        <select class="form-control" (change)="changedCountryHandler($event.target.value)" [(ngModel)]="node.country">
                            <option value="" disabled selected hidden>{{ 'COUNTRY' | translate }}</option>
                            <option *ngFor="let country of countries" [value]="country.code">
                                {{ country.name }}
                            </option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-6">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'CATEGORY' | translate }}</h6>
                        <select class="form-control" (change)="changedCategoryHandler($event.target.value)" [(ngModel)]="node.category">
                            <option value="" disabled selected hidden>{{ 'CATEGORY' | translate }}</option>
                            <option *ngFor="let category of ODMSCategories" [value]="category.value">
                                {{ category.value }}
                            </option>
                        </select>
                    </nb-card-body>
                </div>
            </div>
            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'DESCRIPTION' | translate }}</h6>
                <input type="text" nbInput fullWidth status="primary" placeholder="{{ 'DESCRIPTION' | translate }}" [(ngModel)]="node.description">
            </nb-card-body>

            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'HOMEPAGE' | translate }}</h6>
                <input type="url" nbInput fullWidth status="primary" placeholder="{{ 'HOMEPAGE' | translate }}" 
                [(ngModel)]="node.homepage"
                [disabled]="node.nodeType === 'DCATDUMP'"
                [required]="node.nodeType !== 'DCATDUMP'">
            </nb-card-body>

            <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                <h6 class="jumbotron-heading">{{ 'API_ENDPOINT' | translate }}</h6>
                <!--ZENODO--->
                <input type="url" nbInput fullWidth status="primary" placeholder="{{ 'API_ENDPOINT' | translate }}"     
                [(ngModel)]="node.host"
                [disabled]="true"
                *ngIf="node.nodeType == 'ZENODO'"
                readonly>                

                <input type="url" nbInput fullWidth status="primary" placeholder="{{ 'API_ENDPOINT' | translate }}"
                [(ngModel)]="node.host"
                [disabled]="modifyId || node.nodeType === 'DCATDUMP'"
                [required]="node.nodeType !== 'DCATDUMP'"
                *ngIf="node.nodeType != 'ZENODO'">
 
            </nb-card-body>

            <div class="row show-grid">
                <div class="col-md-4">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'TYPE' | translate }}</h6>
                        <select class="form-control" (change)="changedTypeHandler($event.target.value)" [(ngModel)]="node.nodeType" required [disabled]="modifyId ? true : null">
                            <option value="" disabled selected hidden>{{ 'TYPE' | translate }}</option>
                            <option *ngFor="let type of nodeType" [value]="type.value">
                                {{ type.value }}
                            </option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-4">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'ACTIVE' | translate }}</h6>
                        <select class="form-control" (change)="changedActiveHandler($event.target.value)" [(ngModel)]="node.isActive" [disabled]="modifyId ? true : null">
                            <option *ngFor="let mode of activeMode" [value]="mode.value">
                                {{ mode.text }}
                            </option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-4">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'REFRESH_PERIOD' | translate }}</h6>
                        <select class="form-control" (change)="changedRefreshHandler($event.target.value)" [(ngModel)]="node.refreshPeriod">
                            <option *ngFor="let period of updatePeriods" [value]="period.value">
                                {{ period.text }}
                            </option>
                            <option *ngIf="node.nodeType == 'NGSILD_CB'" value="0">{{ 'AUTO_UPDATE' | translate }}</option>
                        </select>
                    </nb-card-body>
                </div>


                    <div class="col-md-12" *ngIf="node.nodeType == 'ZENODO'">
                        <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                            <h6 class="jumbotron-heading">Communities:</h6>
                            <input type="text" nbInput fullWidth status="primary" placeholder="communities" [(ngModel)]="node.communities"
                            [required]="!modifyId ? true : null" [disabled]="modifyId ? true : null">
                        </nb-card-body>
                    </div>

                    <div class="col-md-6" *ngIf="node.nodeType == 'NATIVE'">
                        <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                            <h6 class="jumbotron-heading">Federation Level:</h6>
                            <select
                                class="form-control"
                                (change)="updateFederationLevel($event.target.value)"
                                [(ngModel)]="node.federationLevel"
                            >
                                <option value="" disabled selected hidden>Federation Level</option>
                                <option value="LEVEL_0">LEVEL_0</option>
                                <option value="LEVEL_1">LEVEL_1</option>
                                <option value="LEVEL_2">LEVEL_2</option>
                                <option value="LEVEL_3">LEVEL_3</option>
                                <option value="LEVEL_4">LEVEL_4</option>
                            </select>
                        </nb-card-body>
                    </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'DCATDUMP'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'DUMP_FILE' | translate }}</h6>
                        <div class="custom-file d-flex flex-row align-items-center justify-content-center">
                            <input nbInput type="file" class="form-control background-white" multiple id="importFile" (change)="onFileChange($event.target.files[0],1)">
                            <nb-icon *ngIf="this.node.dumpString != ''; else emptyDumpString" nbTooltip="{{ 'DUMP_FILE_CHECK' | translate }}" icon="checkmark-square-2-outline" class="ml-1"></nb-icon>
                            <ng-template #emptyDumpString>
                                <nb-icon nbTooltip="{{ 'DUMP_FILE_MISSING' | translate }}" icon="close-square-outline" class="ml-1"></nb-icon>
                            </ng-template>
                            <nb-icon nbTooltip="{{ 'DUMP_FILE_MODIFY' | translate }}"  icon="edit-2-outline" [options]="{ animation: { type: 'zoom' } }" class="ml-1" (click)="handleOpenEditorDialog()"></nb-icon>
                        </div>
                    </nb-card-body>
                </div>


                <div class="col-md-6" *ngIf="node.nodeType == 'DCATDUMP'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'PROFILE' | translate }}</h6>
                        <select class="form-control" (change)="updateDcatProfile($event.target.value)" [(ngModel)]="node.dcatProfile">
                            <option value="" disabled selected hidden>{{ 'PROFILE' | translate }}</option>
                            <option value="DCATAP">{{ 'DCATAP_IT' | translate }}</option>
                            <option value="DCATAP_IT">{{ 'DCATAP_IT' | translate }}</option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-12" *ngIf="node.nodeType == 'DCATDUMP'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'DUMP_URL' | translate }}</h6>
                        <input type="text" nbInput fullWidth status="primary" placeholder="{{ 'DUMP_URL' | translate }}" [(ngModel)]="node.dumpURL">
                    </nb-card-body>
                </div>

                <div class="col-md-12" *ngIf="node.nodeType == 'JUNAR'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'API_KEY' | translate }}</h6>
                        <input type="text" nbInput fullWidth status="primary" placeholder="{{ 'API_KEY' | translate }}" [(ngModel)]="node.APIKey">
                    </nb-card-body>
                </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'NATIVE'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'FEDERATION_LEVEL' | translate }}</h6>
                        <select class="form-control" (change)="updateFederationLevel($event.target.value)" [(ngModel)]="node.federationLevel">
                            <option value="" disabled selected hidden>{{ 'FEDERATION_LEVEL' | translate }}</option>
                            <option value="LEVEL_0">{{ 'LEVEL_0' | translate }}</option>
                            <option value="LEVEL_1">{{ 'LEVEL_1' | translate }}</option>
                            <option value="LEVEL_2">{{ 'LEVEL_2' | translate }}</option>
                            <option value="LEVEL_3">{{ 'LEVEL_3' | translate }}</option>
                            <option value="LEVEL_4">{{ 'LEVEL_4' | translate }}</option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'ORION'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'JSON_FILE' | translate }}</h6>
                        <div class="custom-file">
                            <input nbInput type="file" class="form-control background-white" multiple id="importFileJsonOrion" (change)="onFileChange($event.target.files[0],2)">
                        </div>
                    </nb-card-body>
                </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'ORION'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'API' | translate }}</h6>
                        <select class="form-control" (change)="updateOrionAPI($event.target.value)" [(ngModel)]="node.additionalConfig.ngsild">
                            <option [value]="false">NGSIv2</option>
                            <option [value]="true">NGSI-LD</option>
                        </select>
                    </nb-card-body>
                </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'SPARQL'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'JSON_FILE' | translate }}</h6>
                        <div class="custom-file">
                            <input nbInput type="file" class="form-control background-white" multiple id="importFileSparql" (change)="onFileChange($event.target.files[0],3)">
                        </div>
                    </nb-card-body>
                </div>

                <div class="col-md-6" *ngIf="node.nodeType == 'WEB'">
                    <nb-card-body class="d-flex flex-column align-items-left justify-content-left">
                        <h6 class="jumbotron-heading">{{ 'JSON_FILE' | translate }}</h6>
                        <div class="custom-file">
                            <input nbInput type="file" class="form-control background-white" multiple id="importFileWeb" (change)="onFileChange($event.target.files[0],4)">
                        </div>
                    </nb-card-body>
                </div>
            </div>

            <div class="row show-grid padding-20" >
                <div class="col-md-4">
                    <button routerLink="../" nbButton fullWidth outline status="primary" (click)="back()">{{ 'BACK' | translate }}</button>
                </div>
                <div class="col-md-4">
                    <button nbButton fullWidth outline status="primary" (click)="resetNode()">{{ 'RESET' | translate }}</button>
                </div>
                <div class="col-md-4">
                    <button nbButton fullWidth hero status="primary" [disabled]='node.nodeType==""' (click)="createNode()" *ngIf="!modifyId; else modify">{{ 'CREATE' | translate }}</button>
                    <ng-template #modify>
                        <button nbButton fullWidth hero status="primary" [disabled]='node.nodeType==""' (click)="createNode()">{{ 'MODIFY' | translate }}</button>
                    </ng-template>
                </div>
            </div>
        </nb-card>
    </div>
</div>